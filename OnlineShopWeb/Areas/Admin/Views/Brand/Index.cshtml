<style>
    .modal-backdrop {
        display: block !important; /* Đảm bảo backdrop được hiển thị */
    }

    .modal {
        opacity: 1 !important; /* Đảm bảo opacity không phải 0 */
        visibility: visible !important; /* Đảm bảo visibility là visible */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    #branchId, #idLable {
        display: none;
    }

    /* Căn chỉnh search input và add button trên cùng một dòng */
    .d-flex {
        display: flex;
        justify-content:space-between;
        margin-bottom:5px
    }

    /* Căn chỉnh button Add sang bên phải */
    .btn-add {
        margin-left: auto;
    }

    /* Cải thiện style cho các button Edit và Delete */
    .btn-edit, .btn-delete {
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 5px;
    }

    .btn-edit {
        background-color: #f0ad4e;
        border-color: #f0ad4e;
        color: white;
    }

        .btn-edit:hover {
            background-color: #ec971f;
            border-color: #ec971f;
        }

    .btn-delete {
        background-color: #d9534f;
        border-color: #d9534f;
        color: white;
    }

        .btn-delete:hover {
            background-color: #c9302c;
            border-color: #c9302c;
        }
</style>

<div class="container mt-5">
    <h1>Brand Management</h1>

    <!-- Search Input and Add Button in the same line -->
    <div class="d-flex">
        <input type="text" id="searchBranch" style="width:60% ;border-radius:5px;outline:none;border:none" placeholder="Search Brands...">
        <button class="btn btn-primary btn-add" style="margin-right:20px" id="btnAdd">Add Brand</button>
    </div>

    <!-- Table -->
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>BranchID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="branchesTable"></tbody>
    </table>
</div>

<!-- Add/Edit Modal -->
<div class="modal fade" id="branchModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="branchForm">
                    <div class="form-group">
                        <label id="idLable" for="branchId">BrandId</label>
                        <input type="text" class="form-control" id="branchId" readonly>
                    </div>
                    <div class="form-group">
                        <label for="branchName">Name</label>
                        <input type="text" class="form-control" id="branchName" required>
                    </div>
                    <div class="form-group">
                        <label for="branchDescription">Description</label>
                        <textarea class="form-control" id="branchDescription" required></textarea>
                    </div>
                    <button type="submit" style="margin-left:70%;width:30%" class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Load Brands with optional search term
        loadBrands();

        function loadBrands(searchTerm = "") {
            $.ajax({
                url: `/Admin/Brand/GetBrands?searchTerm=${searchTerm}`,
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    let rows = '';
                    data.forEach(brand => {
                        rows += `<tr>
                        <td>${brand.BrandId}</td>
                        <td>${brand.Name}</td>
                        <td>${brand.Description}</td>
                        <td>
                            <button class="btn btn-warning btnEdit" data-id="${brand.BrandId}">Edit</button>
                            <button class="btn btn-danger btnDelete" data-id="${brand.BrandId}">Delete</button>
                        </td>
                     </tr>`;
                    });
                    $('#branchesTable').html(rows);
                },
                error: function (xhr, status, error) {
                    toastr.error("Error: " + error, "Error");
                }
            });
        }

        // Search Brands
        $('#searchBranch').on('input', function () {
            const searchTerm = $(this).val();
            loadBrands(searchTerm); // Reload brands based on search input
        });

        // Open Add Modal
        $('#btnAdd').click(function () {
            $('#branchId').val('');
            $('#branchName').val('');
            $('#branchDescription').val('');
            $('#modalTitle').text('Add Brand');
            $('#branchModal').modal('show');
        });

        // Save Brand
        $('#branchForm').submit(function (e) {
            e.preventDefault();
            const brand = {
                branchId: $('#branchId').val(),
                name: $('#branchName').val(),
                description: $('#branchDescription').val()
            };

            const url = brand.branchId ? '/Admin/Brand/EditBrand' : '/Admin/Brand/AddBrand';
            $.ajax({
                url: url,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(brand),
                success: function (response) {
                    if (response.success) {
                        $('#branchModal').modal('hide');
                        loadBrands(); // Reload the list after saving
                    } else {
                        toastr.error("Error: " + response.message, "Error");
                    }
                },
                error: function (xhr, status, error) {
                    toastr.error("Error: " + error, "Error");
                }
            });
        });

        // Open Edit Modal
        $(document).on('click', '.btnEdit', function () {
            const id = $(this).data('id');
            $.ajax({
                url: `/Admin/Brand/GetBrandbyId?id=${id}`,
                method: 'GET',
                success: function (brand) {
                    console.log(brand);
                    $('#branchId').val(id);
                    $('#branchName').val(brand.Name);
                    $('#branchDescription').val(brand.Description);
                    $('#modalTitle').text('Edit Brand');
                    $('#branchId').show();
                    $('#idLable').show();
                    $('#branchModal').modal('show');
                },
                error: function (xhr, status, error) {
                    toastr.error("Error: " + error, "Error");
                }
            });
        });

        // Delete Brand
        $(document).on('click', '.btnDelete', function () {
            const id = $(this).data('id');
            if (confirm('Are you sure you want to delete this brand?')) {
                $.ajax({
                    url: '/admin/Brand/DeleteBrand',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ branchId: id }),
                    success: function (response) {
                        if (response.success) {
                            loadBrands(); // Reload the list after deletion
                        } else {
                            toastr.error("Error: " + response.message, "Error");
                        }
                    },
                    error: function (xhr, status, error) {
                        toastr.error("Error: " + error, "Error");
                    }
                });
            }
        });

        // Hide branchId and idLable when modal is closed
        $('#branchModal').on('hidden.bs.modal', function () {
            $('#branchId').hide();
            $('#idLable').hide();
        });
    });
</script>
    