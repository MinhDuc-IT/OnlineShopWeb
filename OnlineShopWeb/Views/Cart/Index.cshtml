@model IEnumerable<OnlineShopWeb.Models.CartItem>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Cart | E-Shopper</title>
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/css/font-awesome.min.css" rel="stylesheet">
    <link href="~/Content/css/prettyPhoto.css" rel="stylesheet">
    <link href="~/Content/css/price-range.css" rel="stylesheet">
    <link href="~/Content/css/animate.css" rel="stylesheet">
    <link href="~/Content/css/main.css" rel="stylesheet">
    <link href="~/Content/css/responsive.css" rel="stylesheet">
    <link href="~/Content/css/footerCart.css" rel="stylesheet" />

    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>

    <link rel="shortcut icon" href="images/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57-precomposed.png">

</head><!--/head-->

<body>

    <section id="cart_items">
        <div class="container">
            <div class="breadcrumbs">
                <ol class="breadcrumb">
                    <li><a href="#">Home</a></li>
                    <li class="active">Shopping Cart</li>
                </ol>
            </div>
            <div class="table-responsive cart_info" id="load_data">
                <table class="table table-condensed">
                    <thead>
                        <tr class="cart_menu">
                            <td class="image">Item</td>
                            <td class="description"></td>
                            <td class="price">Price</td>
                            <td class="quantity">Quantity</td>
                            <td class="total">Total</td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody>

                        @{
                            var sum = decimal.Zero;
                        }

                        @if (Model != null && Model.Any())
                        {

                            foreach (var item in Model)
                            {
                                <tr id="trow_@item.ProductId">
                                    <td class="cart_product">
                                        <input type="checkbox" class="item-select" data-price="@item.TotalPrice" data-id="@item.ProductId">
                                        <a href=""><img src="@item.Product.Image" alt="ProductImage"></a>
                                    </td>
                                    <td class="cart_description">
                                        <h4><a href="">@item.Product.Name</a></h4>
                                    </td>
                                    <td class="cart_price">
                                        <p>@item.Price</p>
                                    </td>
                                    <td class="cart_quantity">
                                        <div class="cart_quantity_button">
                                            <a class="cart_quantity_up" data-id="@item.ProductId" href=""> + </a>
                                            <input class="cart_quantity_input" type="text" name="quantity" value="@item.Quantity" autocomplete="off" size="2">
                                            <a class="cart_quantity_down" data-id="@item.ProductId" href=""> - </a>
                                        </div>
                                    </td>
                                    <th class="cart_total">
                                        <p class="cart_total_price">@item.TotalPrice</p>
                                    </th>
                                    <td class="cart_delete">
                                        <a data-id="@item.ProductId" class="cart_quantity_delete" href="#"><i class="fa fa-times"></i></a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7">Your cart is empty!</td>
                            </tr>
                        }

                        <div class="fixed-footer">
                            <div class="actions">
                                <input type="checkbox" id="selectAll"> <label for="selectAll">Select All</label>
                                <div class="btn-group">
                                    <button class="btn btn-danger btnDeleteSelected">Delete Selected</button>
                                    <button class="btn btn-success btnPurchase">Checkout</button>
                                </div>
                            </div>
                            <div class="sum">
                                <strong>Sum:</strong> <span id="sum">@sum</span> VND
                            </div>
                        </div>

                    </tbody>
                </table>
            </div>
        </div>
    </section> <!--/#cart_items-->

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('.item-select');
        const selectAll = document.getElementById('selectAll');
        const btnPurchase = document.querySelector('.btnPurchase');

        btnPurchase.style.display = 'none';

        // Load selected items from sessionStorage
        const savedItems = JSON.parse(sessionStorage.getItem('selectedItems')) || {};

        // Initialize checkbox states from sessionStorage
        checkboxes.forEach(checkbox => {
            const productId = checkbox.getAttribute('data-id');
            if (savedItems[productId]) {
                checkbox.checked = true;
            }

            // Update sessionStorage when a checkbox is clicked
            checkbox.addEventListener('change', function () {
                if (this.checked) {
                    savedItems[productId] = {
                        productId: productId,
                        quantity: checkbox.closest('tr').querySelector('.cart_quantity_input').value
                    };
                } else {
                    delete savedItems[productId];
                }
                sessionStorage.setItem('selectedItems', JSON.stringify(savedItems));

                updatePurchaseButtonVisibility();
            });
        });

        // "Select All" functionality
        selectAll.addEventListener('change', function () {
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
                const productId = checkbox.getAttribute('data-id');
                if (this.checked) {
                    savedItems[productId] = {
                        productId: productId,
                        quantity: checkbox.closest('tr').querySelector('.cart_quantity_input').value
                    };
                } else {
                    delete savedItems[productId];
                }
            });
            sessionStorage.setItem('selectedItems', JSON.stringify(savedItems));

            updatePurchaseButtonVisibility();

        });

        function updatePurchaseButtonVisibility() {
            if (Object.keys(savedItems).length > 0) {
                btnPurchase.style.display = 'block';
            } else {
                btnPurchase.style.display = 'none';
            }
        }

        btnPurchase.addEventListener('click', function (e) {
            e.preventDefault();
            window.location.href = '@Url.Action("Checkout","Order")';
        });

        updatePurchaseButtonVisibility();

    });

    </script>
</body>
</html>